- name: Install and Start APISIX on MacBook Pro
  hosts: all
  become: yes  # 仍然需要 sudo
  vars:
    ansible_become_password: "your_sudo_password"
  tasks:
    - name: 确保 Docker 运行
      shell: systemctl start docker || open -a Docker
      ignore_errors: yes

    - name: 拉取 APISIX 最新 Docker 镜像
      shell: /usr/local/bin/docker pull apache/apisix:latest


    - name: 确保 APISIX 容器未运行
      shell: docker rm -f apisix || true

    - name: 运行 APISIX 容器
      shell: /usr/local/bin/docker run -d --name apisix  -p 9080:9080 -p 9443:9443  apache/apisix:latest


    - name: 验证 APISIX 是否正常运行
      shell: /usr/local/sbin/docker ps | grep apisix
      register: apisix_status
      changed_when: false

    - name: 显示 APISIX 运行状态
      debug:
        msg: "{{ apisix_status.stdout }}"
